<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html ng-app="App">
<head>
    <title>Infinite Scroll in AngularJS</title>
    <style type="text/css">
        div.content {
            padding: 50px;
            margin: 50px;
            height: 400px;
            width: 400px;
            overflow: scroll;
            /* border: 1px solid black;
             border-radius: 5px;
             */
            border: 0;
            border-radius: 0;
        }

        div.content div {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<div ng-controller="Ctrl as ctrl">
    <input ng-model="ctrl.hello" type="text"/> {{ ctrl.hello }}
    <div id="scroller" class="content" infinite-scroll='{ "size": 50 }'>
        Yo {{ ctrl.getName(isOffset) }}
    </div>
</div>
<script type="text/javascript" src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.1.5/angular.min.js"></script>
<script type="text/javascript">
    var App = angular.module("App", []);
    const BOUNDS_REACHED_EVENT = "InfiniteScrollOffsetMoved";

    App.directive("infiniteScroll", function () {
        console.log("starting infiniteScroll directive");
        var arr = [];

        function getFirstElementChild(parent) {
            // Not supported in old IE
            if (parent.firstElementChild) {
                return parent.firstElementChild;
            }
            var node = parent.firstChild,
                    firstElementChild = null;

            for (; node; node = node.nextSibling) {
                if (node.nodeType === 1) {
                    firstElementChild = node;
                    break;
                }
            }
            return null;
        }

        function findTopPosition(element) {
            var heightHiddenInScroll = element.scrollTop + element.offsetTop,
                    next = getFirstElementChild(element),
                    found = false,
                    difference = 0;
            while (!found || next == null) {
                if (next.offsetTop >= heightHiddenInScroll) {
                    console.log(heightHiddenInScroll + " " + next.offsetTop);
                    difference = next.offsetTop - heightHiddenInScroll;
                    found = true;
                } else {
                    next = next.nextSibling;
                }
            }
            return next.offsetTop + difference;
        }

        function reachedBounds(element) {
            var completeHeight = element.scrollHeight,
                    boundSize = (completeHeight / 5),
                    top = element.scrollTop,
                    bottom = top + element.clientHeight,
                    topInBounds = top < boundSize,
                    bottomInBounds = (completeHeight - boundSize ) < bottom;
            if (topInBounds || bottomInBounds) {
                return topInBounds ? -1 : 1;
            }
            return 0;
        }


        function linkFn(scope, elm, attr) {
            console.log("starting linker");
            function onScroll(event) {
                // it's -1, 0 or 1
                var boundsReached = reachedBounds(elm[0]);
                if (boundsReached) {
                    var topPosition = findTopPosition(elm[0]);
                    elm[0].scrollTop = topPosition;
                    scope.$apply(function () {
                        scope.$broadcast(BOUNDS_REACHED_EVENT, boundsReached * 25);
                    });
                }
            }

            elm.bind("scroll", onScroll);
        }

        function controller($scope, $attrs) {

            var settings = angular.fromJson($attrs.infiniteScroll);
            console.log("starting controller with size: " + settings.size);
            for (var i = -settings.size; i < settings.size; i++) {
                arr.push({ p: i, element: null});
            }
            $scope.__infiniteScrollSizer = arr;

            $scope.__infiniteScrollRegister = function (i, el) {
                arr[i].element = el;
                // Check if all children have called home
                if ((i + 1) === arr.length) {
                    arr[settings.size].element[0].scrollIntoView(true);
                }
                return arr[i].p;
            }

        }

        return {
            controller: ['$scope', '$attrs', controller],
            scope: true,
            transclude: true,
            template: '<div ng-repeat="infinitePoint in __infiniteScrollSizer"' +
                    '    infinite-scroll-register-element="infinitePoint.p">' +
                    '        <div ng-transclude></div>' +
                    '</div>',
            link: linkFn
        }
    });
    App.directive("infiniteScrollRegisterElement", function () {
        //console.log("starting infiniteScrollRegisterElement directive")
        return function (scope, elm, attr) {
            var isOffset = scope.__infiniteScrollRegister(scope.$index, elm);
            scope.isOffset = isOffset;
            scope.$on(BOUNDS_REACHED_EVENT, function (event, delta) {
                scope.isOffset += delta;
            });
        }
    });
    App.controller("Ctrl", function Ctrl() {
        this.hello = "How's things?";

        this.getName = function (number) {
            return "Dude number " + number;
        }
    });
</script>

</body>
</html>