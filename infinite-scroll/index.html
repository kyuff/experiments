<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html ng-app="App">
<head>
    <title>Infinite Scroll in AngularJS</title>
    <style type="text/css">
        div.content {
            margin: 25px;
            height: 400px;
            width: 400px;
            overflow: scroll;
            border: 1px solid black;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div ng-controller="Ctrl as ctrl">
    <input ng-model="ctrl.hello" type="text"/> {{  ctrl.hello }}
    <div class="content" infinite-scroll='{ "size": 50 }'>
        Yo {{  ctrl.getName(isOffset) }}
    </div>
</div>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.1.5/angular.min.js"></script>
<script type="text/javascript">
    var App = angular.module("App", []);

    App.directive("infiniteScroll", function () {
        console.log("starting infiniteScroll directive");
        var arr = [];
        function linkFn(scope, elm, attr) {
            console.log("starting linker");
            elm.bind("scroll", function(event) {
                var completeHeight = elm[0].scrollHeight,
                    boundSize = (completeHeight / 5),
                    top = elm[0].scrollTop,
                    bottom = top + elm[0].clientHeight,
                    topInBounds = top < boundSize,
                    bottomInBounds = (completeHeight - boundSize ) < bottom;
                if( topInBounds || bottomInBounds ) {
                    console.log(topInBounds + " " + bottomInBounds);
                }
                //console.log("height: " + completeHeight + " top: " + top + " bottom: " + bottom);

            });
        }

        function controller($scope, $attrs) {

            var settings = angular.fromJson($attrs.infiniteScroll);
            console.log("starting controller with size: " + settings.size);
            for (var i = -settings.size; i < settings.size; i++) {
                arr.push({ p: i, element: null});
            }
            $scope.__infiniteScrollSizer = arr;

            $scope.__infiniteScrollRegister = function(i, el) {
                arr[i].element = el;
                // Check if all children have called home
                if( (i+1) === arr.length ) {
                    arr[settings.size].element[0].scrollIntoView(true);
                }
                return arr[i].p;
            }

        }

        return {
            controller: ['$scope', '$attrs', controller],
            scope: true,
            transclude: true,
            template : '<div ng-repeat="infinitePoint in __infiniteScrollSizer"' +
                       '    infinite-scroll-register-element="infinitePoint.p">' +
                       '        <div ng-transclude></div>' +
                       '</div>',
            link: linkFn
        }
    });
    App.directive("infiniteScrollRegisterElement", function () {
        //console.log("starting infiniteScrollRegisterElement directive")
        return function (scope, elm, attr) {
            var isOffset = scope.__infiniteScrollRegister(scope.$index, elm);
            scope.isOffset = isOffset;
        }
    });
    App.controller("Ctrl", function Ctrl() {
        this.hello = "How's things?";

        this.getName = function(number) {
            return "Dude number " + number;
        }
    });
</script>

</body>
</html>